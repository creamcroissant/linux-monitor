import{r as a,c as e,aw as l,h as t,y as d,z as n,P as s,H as o,ag as u,aq as i,I as r,G as m,A as p,L as c,M as f}from"./vendor-wniUkaaU.js";import{a as v}from"./index-0kTfrp-L.js";import{_ as h}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{a as _,f as g}from"./element-plus-BmMKkfCB.js";const b={class:"manage-container"},w={class:"dialog-footer"},y=h({__name:"Manage",setup(h){const y=l(),V=a(!1),x=a(!1),k=a(!1),C=a({id:null,name:"",hostname:"",ip_address:"",platform:""}),U=e((()=>y.state.agents)),j=async()=>{V.value=!0;try{await y.dispatch("fetchAgents")}catch(a){_.error("获取代理列表失败")}finally{V.value=!1}},A=async()=>{if(C.value.id){x.value=!0;try{await v.updateAgent(C.value.id,{name:C.value.name}),_.success("保存成功"),k.value=!1,j()}catch(a){_.error("保存失败")}finally{x.value=!1}}},I=async a=>{try{await v.deleteAgent(a),_.success("删除成功"),j()}catch(e){_.error("删除失败")}};return t((async()=>{await j()})),(a,e)=>{const l=u("el-tag"),t=u("el-table-column"),v=u("el-button"),h=u("el-table"),_=u("el-card"),y=u("el-input"),j=u("el-form-item"),z=u("el-form"),O=u("el-dialog"),P=i("loading");return n(),d("div",b,[s(_,null,{header:o((()=>e[6]||(e[6]=[p("div",{class:"card-header"},[p("span",null,"代理管理")],-1)]))),default:o((()=>[r((n(),m(h,{data:U.value,style:{width:"100%"}},{default:o((()=>[s(t,{prop:"name",label:"名称","min-width":"120"},{default:o((({row:a})=>[s(l,{type:a.isOnline?"success":"danger",class:"status-tag"},{default:o((()=>[c(f(a.isOnline?"在线":"离线"),1)])),_:2},1032,["type"]),p("span",null,f(a.name||a.hostname),1)])),_:1}),s(t,{prop:"hostname",label:"主机名","min-width":"150"}),s(t,{prop:"ip_address",label:"IP地址","min-width":"120"}),s(t,{prop:"platform",label:"平台","min-width":"100"}),s(t,{label:"最后连接时间","min-width":"160"},{default:o((({row:a})=>{return[c(f((e=a.last_seen,e?new Date(1e3*e).toLocaleString():"从未连接")),1)];var e})),_:1}),s(t,{label:"操作",width:"250",fixed:"right"},{default:o((({row:a})=>[s(v,{type:"primary",size:"small",onClick:e=>{return l=a,C.value={id:l.id,name:l.name||"",hostname:l.hostname,ip_address:l.ip_address,platform:l.platform},void(k.value=!0);var l}},{default:o((()=>e[7]||(e[7]=[c(" 编辑 ")]))),_:2},1032,["onClick"]),s(v,{type:"danger",size:"small",onClick:e=>{return l=a,void g.confirm(`确定要删除代理 ${l.name||l.hostname} 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then((()=>{I(l.id)})).catch((()=>{}));var l},disabled:a.isOnline},{default:o((()=>e[8]||(e[8]=[c(" 删除 ")]))),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data"])),[[P,V.value]])])),_:1}),s(O,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=a=>k.value=a),title:"编辑代理",width:"500px"},{footer:o((()=>[p("div",w,[s(v,{onClick:e[4]||(e[4]=a=>k.value=!1)},{default:o((()=>e[9]||(e[9]=[c("取消")]))),_:1}),s(v,{type:"primary",onClick:A,loading:x.value},{default:o((()=>e[10]||(e[10]=[c(" 保存 ")]))),_:1},8,["loading"])])])),default:o((()=>[s(z,{model:C.value,"label-width":"100px"},{default:o((()=>[s(j,{label:"名称"},{default:o((()=>[s(y,{modelValue:C.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>C.value.name=a),placeholder:"代理名称"},null,8,["modelValue"])])),_:1}),s(j,{label:"主机名"},{default:o((()=>[s(y,{modelValue:C.value.hostname,"onUpdate:modelValue":e[1]||(e[1]=a=>C.value.hostname=a),disabled:""},null,8,["modelValue"])])),_:1}),s(j,{label:"IP地址"},{default:o((()=>[s(y,{modelValue:C.value.ip_address,"onUpdate:modelValue":e[2]||(e[2]=a=>C.value.ip_address=a),disabled:""},null,8,["modelValue"])])),_:1}),s(j,{label:"平台"},{default:o((()=>[s(y,{modelValue:C.value.platform,"onUpdate:modelValue":e[3]||(e[3]=a=>C.value.platform=a),disabled:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-a283d417"]]);export{y as default};
